<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Личный кабинет</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="styles.css">
<style>
  body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f9f9f9; }
  .header, .footer { background:#fff; padding:10px 20px; box-shadow:0 2px 5px rgba(0,0,0,0.1);}
  .container { max-width: 900px; margin: 0 auto; padding:20px; }

  /* Модальное окно */
  .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:1000; }
  .modal.active { display:flex; }
  .modal-content { background:#fff; padding:30px; border-radius:10px; width:100%; max-width:400px; box-shadow:0 5px 15px rgba(0,0,0,0.3); position:relative; }
  .modal-content h2 { margin-top:0; text-align:center; }
  .modal-content form { display:flex; flex-direction:column; gap:12px; }
  .modal-content input { padding:10px; border-radius:6px; border:1px solid #ccc; width:100%; }
  .modal-content button { padding:10px; border:none; border-radius:6px; background:#007bff; color:#fff; font-weight:bold; cursor:pointer; }
  .modal-toggle { text-align:center; margin-top:10px; cursor:pointer; color:#007bff; }
  .close-modal { position:absolute; top:10px; right:15px; font-size:20px; cursor:pointer; }

  /* Кабинет */
  .cabinet-nav { display:flex; gap:20px; margin-bottom:20px; }
  .cabinet-nav a { cursor:pointer; font-weight:bold; text-decoration:none; color:#333; padding:6px 12px; border-radius:6px; background:#f5f5f5; }
  .cabinet-nav a.active { background:#007bff; color:#fff; }
  .cabinet-section { display:none; }
  .cabinet-section.active { display:block; }
  .car-card { border:1px solid #ddd; padding:12px; margin-bottom:10px; border-radius:8px; display:flex; justify-content:space-between; align-items:center; }
  .car-actions button { margin-left:8px; }
</style>
</head>
<body>
<header class="header">
  <div class="container">
    <a href="index.html" class="logo">Логотип</a>
    <a href="index.html" class="button small-btn">← На главную</a>
  </div>
</header>

<section class="cabinet container">
  <h2>Личный кабинет</h2>
  
  <nav id="cabinetNav" class="cabinet-nav" style="display:none;">
    <a class="active" data-tab="my-cars">Мои объявления</a>
    <a data-tab="add-car">Добавить авто</a>
    <a data-tab="orders">Заявки</a>
    <a id="logoutBtn">Выйти</a>
  </nav>

  <div id="my-cars" class="cabinet-section active"></div>
  <div id="add-car" class="cabinet-section">
    <form id="addCarForm">
      <input type="text" name="brand" placeholder="Марка" required>
      <input type="text" name="model" placeholder="Модель" required>
      <input type="number" name="year" placeholder="Год выпуска" required>
      <input type="number" name="price" placeholder="Цена в сутки" required>
      <textarea name="description" placeholder="Описание"></textarea>
      <input type="file" name="photo">
      <button type="submit" class="button">Добавить</button>
    </form>
  </div>
  <div id="orders" class="cabinet-section"></div>
</section>

<!-- Модальное окно авторизации -->
<div id="authModal" class="modal">
  <div class="modal-content">
    <span class="close-modal" id="closeModal">&times;</span>
    
    <h2 id="authTitle">Вход в аккаунт</h2>
    
    <form id="loginForm">
      <input type="text" name="username" placeholder="Имя пользователя" required>
      <input type="password" name="password" placeholder="Пароль" required>
      <button type="submit">Войти</button>
    </form>
    
    <form id="registerForm" style="display:none;">
      <input type="text" name="username" placeholder="Имя пользователя" required>
      <input type="email" name="email" placeholder="Email" required>
      <input type="tel" name="phone" placeholder="Телефон" required>
      <input type="password" name="password" placeholder="Пароль" required>
      <button type="submit">Зарегистрироваться</button>
    </form>
    
    <div class="modal-toggle" id="toggleAuth">Нет аккаунта? Зарегистрироваться</div>
  </div>
</div>

<footer class="footer">
  <div class="container">Все права защищены</div>
</footer>

<script>
  const API_URL = "https://твое-доменное-имя/api";
  let token = localStorage.getItem('token');

  const authModal = document.getElementById('authModal');
  const loginForm = document.getElementById('loginForm');
  const registerForm = document.getElementById('registerForm');
  const toggleAuth = document.getElementById('toggleAuth');
  const authTitle = document.getElementById('authTitle');
  const closeModal = document.getElementById('closeModal');

  function showModal() { authModal.classList.add('active'); }
  function hideModal() { authModal.classList.remove('active'); }

  closeModal.addEventListener('click', hideModal);
  window.addEventListener('click', e => { if(e.target === authModal) hideModal(); });

  toggleAuth.addEventListener('click', () => {
    if(loginForm.style.display !== 'none'){
      loginForm.style.display = 'none';
      registerForm.style.display = 'flex';
      authTitle.textContent = 'Регистрация';
      toggleAuth.textContent = 'Уже есть аккаунт? Войти';
    } else {
      loginForm.style.display = 'flex';
      registerForm.style.display = 'none';
      authTitle.textContent = 'Вход в аккаунт';
      toggleAuth.textContent = 'Нет аккаунта? Зарегистрироваться';
    }
  });

  function setAuth(tokenValue) {
    token = tokenValue;
    localStorage.setItem('token', token);
    hideModal();
    document.getElementById('cabinetNav').style.display = 'flex';
    loadMyCars();
    loadOrders();
  }

  // --------- Вход ----------
  loginForm.addEventListener('submit', async e => {
    e.preventDefault();
    const form = e.target;
    const res = await fetch(`${API_URL}/auth/login`, {
      method:'POST', headers:{'Content-Type':'application/json'},
      body:JSON.stringify({username: form.username.value, password: form.password.value})
    });
    if(res.ok){ const data = await res.json(); setAuth(data.token); }
    else alert('Неверные данные');
  });

  // --------- Регистрация ----------
  registerForm.addEventListener('submit', async e => {
    e.preventDefault();
    const form = e.target;
    const res = await fetch(`${API_URL}/auth/register`, {
      method:'POST', headers:{'Content-Type':'application/json'},
      body:JSON.stringify({
        username: form.username.value,
        email: form.email.value,
        phone: form.phone.value,
        password: form.password.value
      })
    });
    if(res.ok){ alert('Регистрация успешна. Войдите.'); toggleAuth.click(); }
    else alert('Ошибка регистрации');
  });

  // --------- Личный кабинет ----------
  document.getElementById('logoutBtn').addEventListener('click', () => {
    token = null; localStorage.removeItem('token'); location.reload();
  });

  // Навигация по вкладкам
  document.querySelectorAll('.cabinet-nav a[data-tab]').forEach(link=>{
    link.addEventListener('click',()=>{
      document.querySelectorAll('.cabinet-nav a').forEach(l=>l.classList.remove('active'));
      link.classList.add('active');
      document.querySelectorAll('.cabinet-section').forEach(sec=>sec.classList.remove('active'));
      document.getElementById(link.dataset.tab).classList.add('active');
    });
  });

  async function loadMyCars(){ /* TODO: fetch your cars */ myCarsDiv.innerHTML='Загрузка...'; }
  async function loadOrders(){ /* TODO: fetch your orders */ ordersDiv.innerHTML='Загрузка...'; }

  // Если нет токена — показать модальное окно
  if(!token) showModal();
  else setAuth(token);
</script>
</body>
</html>
