<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <title>Car Rent</title>
    <base href="/" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <main class="main">
      <header class="header">
        <div class="container">
          <div class="logo"><img src="images/logo.png" alt="Logo" /></div>
          <nav class="menu">
            <ul>
              <li><a href="#cars">НАШ автопарк</a></li>
              <li><a href="#order">Забронировать</a></li>
            </ul>
          </nav>
          <a href="tel:+971523898989" class="phone">+971 52 389 89 89</a>
        </div>
      </header>

      <section class="main-content">
        <div class="container">
          <div class="main-info">
            <h1>Покорите дороги за рулём легендарных автомобилей!</h1>
            <p>От эксклюзивных спорткаров до гоночных шедевров — выбирайте мечту,
              садитесь за руль и ощутите мощь премиального авто на полную!</p>
            <a href="#cars" class="button">Посмотреть автомобили</a>
          </div>
          <img src="images/main-car.png" alt="main car" class="main-image" />
        </div>
      </section>
      <div class="black-block"></div>
    </main>

    <section class="cars" id="cars">
      <div class="container">
        <h2>Выберите автомобиль</h2>
        <div class="cars-content" id="cars-content">
          <aside class="cars-filter">
            <ul id="brands-list"></ul>
          </aside>
          <div class="cars-items" id="cars-list"></div>
        </div>
      </div>
    </section>

    <section class="order" id="order">
      <div class="container">
        <img src="images/order-car.png" alt="order car" />
        <form id="orderForm">
          <h3>Забронируйте автомобиль</h3>
          <p>Заполните контактные данные, и мы перезвоним вам для подтверждения бронирования</p>
          <div class="order-form">
            <input type="text" placeholder="Автомобиль" required readonly id="car" />
            <input type="text" placeholder="Ваше имя" required id="name" />
            <input type="text" placeholder="Ваш телефон" required minlength="10" id="phone" />
            <button class="button" type="submit" id="order-action">Забронировать</button>
          </div>
        </form>
      </div>
    </section>

    <footer class="footer">
      <div class="container" style="padding:47px 0; border-top:1px solid #5f5f5f; display:flex; justify-content:space-between; align-items:center;">
        <div class="logo"><img src="images/logo.png" alt="Logo" /></div>
        <div class="rights" style="font-size:14px; line-height:90%; letter-spacing:normal; font-weight:bold; text-transform:uppercase;">Все права защищены</div>
      </div>
    </footer>

    <script>
      const API_BASE = "https://cars-api-ur5t.onrender.com/api/cars";

      let allCars = [];

      function buildPrices(base) {
        return [Math.round(base), Math.round(base*0.95), Math.round(base*0.9)];
      }

      function createCarArticle(car) {
        const prices = buildPrices(car.price);
        const article = document.createElement('article');
        article.className = 'car';
        article.innerHTML = `
          <img src="${car.imageUrl}" alt="car" />
          <div class="car-details">
            <h4>${car.brand} ${car.model} (${car.year})</h4>
            <p>${car.description}</p>
            <div class="car-action">
              <ul>
                ${["на 1 сутки","на 1-3 суток","на 3+ суток"].map((p,i)=>`
                  <li>
                    <div class="car-period">${p}</div>
                    <div class="car-price">${prices[i]} $ ${i>0?'<span>/сут</span>':''}</div>
                  </li>
                `).join('')}
              </ul>
              <a href="#order" class="button white-button" data-title="${car.brand} ${car.model}">Забронировать</a>
            </div>
          </div>
        `;
        article.querySelector('a.button.white-button')
               .addEventListener('click', e => document.getElementById('car').value = car.brand + ' ' + car.model);
        return article;
      }

      function renderCars(cars) {
        const list = document.getElementById('cars-list');
        list.innerHTML = '';
        cars.forEach(c => list.appendChild(createCarArticle(c)));
      }

      function renderBrands() {
        const box = document.getElementById('brands-list');
        box.innerHTML = '';
        const uniq = Array.from(new Set(allCars.map(c => c.brand)));
        const makeLi = (name, active=false) => {
          const li = document.createElement('li');
          li.textContent = name;
          if (active) li.classList.add('active');
          li.addEventListener('click', () => {
            [...box.children].forEach(el => el.classList.remove('active'));
            li.classList.add('active');
            renderCars(name==='Все марки'?allCars:allCars.filter(c=>c.brand===name));
            document.getElementById('cars-content').scrollIntoView({behavior:'instant'});
          });
          return li;
        };
        box.appendChild(makeLi('Все марки', true));
        uniq.forEach(b => box.appendChild(makeLi(b)));
      }

      async function loadCars() {
        try {
          const res = await fetch(API_BASE);
          allCars = await res.json();
          renderBrands();
          renderCars(allCars);
        } catch(err) {
          console.error(err);
        }
      }

      document.getElementById('orderForm').addEventListener('submit', e=>{
        e.preventDefault();
        const car = document.getElementById('car').value.trim();
        const name = document.getElementById('name').value.trim();
        const phone = document.getElementById('phone').value.trim();
        if(!car||!name||!phone) return;
        alert(`Заявка отправлена!\nАвто: ${car}\nИмя: ${name}\nТелефон: ${phone}`);
        e.target.reset();
      });

      loadCars();
    </script>
  </body>
</html>
